export const platformDocumentation = {
  metadata: {
    title: "STOREA Platform Documentation",
    subtitle: "Complete Technical & User Experience Guide",
    version: "1.0",
    lastUpdated: new Date().toISOString(),
  },

  systemOverview: {
    title: "System Overview",
    description: "STOREA is a comprehensive construction project management platform built on modern web technologies.",
    techStack: [
      { name: "Frontend", technology: "React 18 + TypeScript + Vite", description: "Modern SPA with type safety" },
      { name: "UI Framework", technology: "Tailwind CSS + shadcn/ui", description: "Responsive design system" },
      { name: "Backend", technology: "Supabase (PostgreSQL + Auth + Storage)", description: "Full-stack backend platform" },
      { name: "Real-time", technology: "Supabase Realtime", description: "Live updates and collaboration" },
      { name: "Edge Functions", technology: "Deno-based serverless", description: "Scalable backend logic" },
    ],
  },

  integrations: {
    title: "External APIs & Integrations",
    services: [
      {
        name: "Supabase",
        purpose: "Backend Infrastructure",
        features: ["PostgreSQL Database", "Authentication & Authorization", "File Storage", "Real-time Subscriptions", "Row-Level Security"],
        cost: "Usage-based pricing",
      },
      {
        name: "Resend",
        purpose: "Email Delivery",
        features: ["Transactional emails", "Team invitations", "RFI notifications", "Tender invitations", "Password resets"],
        setup: "Requires RESEND_API_KEY secret",
        cost: "Free tier: 100 emails/day, then usage-based",
      },
      {
        name: "Open-Meteo Weather API",
        purpose: "Weather Data",
        features: ["Project location weather", "7-day forecast", "Construction planning insights"],
        cost: "Free (no API key required)",
      },
      {
        name: "Nominatim (OpenStreetMap)",
        purpose: "Geocoding",
        features: ["Address → Coordinates conversion", "Project location mapping"],
        cost: "Free (attribution required)",
      },
      {
        name: "Leaflet Maps",
        purpose: "Map Visualization",
        features: ["Interactive project maps", "Location display"],
        cost: "Free (open-source)",
      },
    ],
  },

  edgeFunctions: {
    title: "Supabase Edge Functions",
    functions: [
      {
        name: "send-team-invitation",
        purpose: "Send project invitation emails",
        trigger: "Manual API call from frontend",
        inputs: ["recipientEmail", "projectName", "inviterName", "invitationLink"],
        provider: "Resend",
      },
      {
        name: "send-tender-invitation",
        purpose: "Send tender invitation emails",
        trigger: "Manual API call from frontend",
        inputs: ["recipientEmail", "tenderTitle", "inviterName", "accessLink"],
        provider: "Resend",
      },
      {
        name: "send-rfi-notification",
        purpose: "Notify users of new RFIs or responses",
        trigger: "Manual API call from frontend",
        inputs: ["recipientEmail", "rfiNumber", "projectName", "rfiLink"],
        provider: "Resend",
      },
      {
        name: "send-password-reset",
        purpose: "Send password reset emails",
        trigger: "Password reset flow",
        inputs: ["email", "resetLink"],
        provider: "Resend",
      },
      {
        name: "get-weather",
        purpose: "Fetch weather data for project location",
        trigger: "Dashboard load",
        inputs: ["latitude", "longitude"],
        provider: "Open-Meteo API",
      },
      {
        name: "parse-line-items",
        purpose: "Parse Excel files for tender line items",
        trigger: "File upload in tender builder",
        inputs: ["fileData", "fileType"],
        output: "Structured line item data",
      },
      {
        name: "generate-invite-link",
        purpose: "Generate secure project invitation tokens",
        trigger: "Team member invitation",
        inputs: ["projectId", "inviterEmail"],
        output: "Secure invitation link",
      },
      {
        name: "link-pending-projects",
        purpose: "Link pending projects to newly registered users",
        trigger: "User signup completion",
        inputs: ["userId", "email"],
        output: "Linked projects count",
      },
      {
        name: "security-notifications",
        purpose: "Send security alert emails",
        trigger: "Security events (multiple login attempts, etc.)",
        inputs: ["userEmail", "alertType", "details"],
        provider: "Resend",
      },
    ],
  },

  database: {
    title: "Database Schema",
    description: "PostgreSQL database with 75+ tables organized by functional domain",
    categories: [
      {
        name: "User Management",
        tables: ["profiles", "companies", "user_sessions"],
        description: "User authentication, profiles, company associations",
      },
      {
        name: "Projects",
        tables: ["projects", "project_users", "project_join_requests", "invitations"],
        description: "Project lifecycle, team management, invitation system",
      },
      {
        name: "Documents",
        tables: ["documents", "document_groups", "document_revisions", "document_versions", "document_shares", "document_categories", "document_types", "document_status_options"],
        description: "Document management with versioning, sharing, and approval workflows",
      },
      {
        name: "RFIs (Requests for Information)",
        tables: ["rfis", "rfi_responses", "rfi_attachments", "rfi_templates"],
        description: "RFI submission, tracking, and response management",
      },
      {
        name: "Messages & Communication",
        tables: ["messages", "message_threads", "message_participants", "message_templates"],
        description: "Real-time messaging and threaded conversations",
      },
      {
        name: "Tenders & Procurement",
        tables: ["tenders", "tender_line_items", "tender_bids", "bid_line_items", "tender_invitations", "tender_access_requests", "contractor_prequalifications"],
        description: "Tender creation, bidding, comparison, and award",
      },
      {
        name: "Financial Management",
        tables: ["project_budgets", "line_item_budgets", "progress_claims", "change_orders", "project_invoices", "project_payments", "cashflow_items", "client_contributions", "budget_categories"],
        description: "Budget tracking, progress claims, invoicing, cashflow forecasting",
      },
      {
        name: "Calendar & Tasks",
        tables: ["calendar_events", "event_templates", "todos"],
        description: "Event scheduling, recurring events, task management",
      },
      {
        name: "Notifications",
        tables: ["notifications"],
        description: "In-app notification system",
      },
      {
        name: "Admin & Monitoring",
        tables: ["activity_log", "admin_activity_log", "audit_logs", "admin_alerts", "alert_rules", "alert_notifications"],
        description: "System monitoring, audit trails, administrative controls",
      },
      {
        name: "Telemetry (In Progress)",
        tables: ["telemetry_events", "telemetry_sessions", "telemetry_performance", "telemetry_errors", "error_breadcrumbs", "issue_groups"],
        description: "Error tracking, performance monitoring, user analytics",
      },
    ],
  },

  userRoles: {
    title: "User Roles & Permissions",
    roles: [
      {
        role: "architect",
        title: "Architect",
        description: "Design professionals who create and manage construction drawings, specifications, and RFIs",
        capabilities: [
          "Create and manage projects",
          "Upload and version drawings/specifications",
          "Create and respond to RFIs",
          "Review tender submissions",
          "Manage project documentation",
          "Approve documents and changes",
          "View project financials (read-only)",
        ],
      },
      {
        role: "builder",
        title: "Builder / General Contractor",
        description: "Main contractor managing construction execution and subcontractor coordination",
        capabilities: [
          "Create and manage projects",
          "Create tenders for subcontractor work",
          "Review and compare tender bids",
          "Award contracts to subcontractors",
          "Manage project budget and financials",
          "Submit progress claims",
          "Create RFIs to architects",
          "Upload construction documentation",
          "Manage project team",
        ],
      },
      {
        role: "contractor",
        title: "Contractor / Subcontractor",
        description: "Specialized trade contractors bidding on and executing specific work packages",
        capabilities: [
          "Join projects via invitation or access code",
          "View tender packages",
          "Submit competitive bids with line items",
          "Respond to RFIs",
          "Upload trade-specific documents",
          "View assigned documents and drawings",
          "Receive notifications and updates",
        ],
      },
      {
        role: "homeowner",
        title: "Homeowner / Client",
        description: "Property owner overseeing project and making key decisions",
        capabilities: [
          "View project dashboard and progress",
          "Access project documents (limited)",
          "View financial summary and claims",
          "Receive project updates",
          "Communicate via messages",
          "Approve major changes and variations",
        ],
      },
      {
        role: "system_admin",
        title: "System Administrator",
        description: "Platform administrators with full system access",
        capabilities: [
          "Access admin dashboard",
          "Manage all users and profiles",
          "Approve new user registrations",
          "View system analytics and monitoring",
          "Access audit logs and activity",
          "Manage system alerts and health",
          "Configure system settings",
        ],
      },
    ],
    permissionMatrix: [
      { feature: "Create Projects", architect: true, builder: true, contractor: false, homeowner: false },
      { feature: "Create Tenders", architect: false, builder: true, contractor: false, homeowner: false },
      { feature: "Submit Bids", architect: false, builder: false, contractor: true, homeowner: false },
      { feature: "Award Contracts", architect: false, builder: true, contractor: false, homeowner: false },
      { feature: "Create RFIs", architect: true, builder: true, contractor: true, homeowner: false },
      { feature: "Respond to RFIs", architect: true, builder: true, contractor: true, homeowner: false },
      { feature: "Upload Documents", architect: true, builder: true, contractor: true, homeowner: false },
      { feature: "Manage Financials", architect: false, builder: true, contractor: false, homeowner: false },
      { feature: "View Financials", architect: true, builder: true, contractor: false, homeowner: true },
      { feature: "Submit Progress Claims", architect: false, builder: true, contractor: false, homeowner: false },
      { feature: "Approve Claims", architect: false, builder: false, contractor: false, homeowner: true },
      { feature: "Manage Team", architect: true, builder: true, contractor: false, homeowner: false },
      { feature: "Admin Access", architect: false, builder: false, contractor: false, homeowner: false },
    ],
  },

  userExperience: {
    title: "User Experience by Page",
    publicPages: [
      {
        path: "/",
        name: "Home",
        description: "Marketing landing page with hero section, features overview, pricing, and call-to-action",
        sections: ["Hero with value proposition", "Key features grid", "Pricing tiers", "Client testimonials", "Contact form"],
      },
      {
        path: "/features",
        name: "Features",
        description: "Detailed feature showcase with benefits for each user role",
        sections: ["Document management", "RFI system", "Tender management", "Financial tracking", "Real-time collaboration"],
      },
      {
        path: "/pricing",
        name: "Pricing",
        description: "Pricing plans and feature comparison",
        sections: ["Free tier", "Professional plan", "Enterprise plan", "Feature comparison table"],
      },
      {
        path: "/about",
        name: "About",
        description: "Company information, mission, and team",
      },
      {
        path: "/contact",
        name: "Contact",
        description: "Contact form with email integration (via Resend)",
      },
    ],
    authFlow: {
      name: "Authentication Flow",
      steps: [
        {
          step: "Sign Up",
          description: "Email/password registration with Supabase Auth",
          validation: "Email verification required",
          nextStep: "Profile Setup",
        },
        {
          step: "Profile Setup",
          description: "Optional 3-step wizard for completing profile details",
          fields: ["Personal info (name, phone)", "Professional info (role, experience)", "Company info (name, ABN, certifications)"],
          note: "Can be skipped - no longer mandatory",
        },
        {
          step: "Approval (Optional)",
          description: "New users may require admin approval based on system configuration",
          states: ["Pending approval", "Approved", "Rejected"],
        },
      ],
    },
    authenticatedPages: [
      {
        path: "/dashboard",
        name: "Dashboard",
        description: "Personalized overview of all user activities and projects",
        widgets: [
          { name: "Project Status Overview", roles: ["architect", "builder", "homeowner"], description: "Active projects with status indicators" },
          { name: "Actionable Documents", roles: ["architect", "builder"], description: "Documents requiring review or approval" },
          { name: "Open RFIs", roles: ["architect", "builder", "contractor"], description: "Pending RFI responses" },
          { name: "Calendar Widget", roles: ["all"], description: "Upcoming events and deadlines" },
          { name: "Recent Activity", roles: ["all"], description: "Project timeline of recent actions" },
          { name: "Weather Info", roles: ["builder"], description: "7-day forecast for project location" },
          { name: "To-Do List", roles: ["all"], description: "Personal task management" },
          { name: "Team Members", roles: ["architect", "builder"], description: "Active team members online status" },
        ],
      },
      {
        path: "/projects",
        name: "Projects",
        description: "Project management hub",
        features: {
          architect: [
            "Create new projects",
            "View all projects (owned + member of)",
            "Invite team members by email",
            "Generate shareable join links",
            "Manage project details (name, location, dates)",
            "View project team list with roles",
            "Upload project documents",
          ],
          builder: [
            "All architect features",
            "Set project budget",
            "Track financial metrics",
            "Create tenders for subcontractor packages",
            "View tender responses",
            "Manage subcontractor relationships",
          ],
          contractor: [
            "Join projects via invitation or code",
            "View assigned projects",
            "Access project documents (limited scope)",
            "View tender opportunities",
            "Submit bids on tenders",
          ],
          homeowner: [
            "View projects they're invited to",
            "Monitor project progress",
            "Access financial summary",
            "View documents (limited)",
          ],
        },
        interactions: [
          "Click project card to view details dialog",
          "Project details shows: Info, Team, Documents, Financials tabs",
          "Create project opens wizard: Basic info → Location → Team setup",
          "Invite team: Email invitation or generate link",
          "Project code join: Enter 6-digit code to request access",
        ],
      },
      {
        path: "/documents",
        name: "Documents",
        description: "Centralized document management with version control",
        features: {
          upload: "Drag-and-drop or file browser upload",
          versioning: "Automatic version tracking with revision history",
          organization: "Categories, custom document numbers, tags",
          sharing: "Share with specific users or teams with permission levels (view/edit)",
          approval: "Document approval workflow for critical documents",
          superseding: "Mark documents as superseded by newer versions",
          locking: "Lock documents to prevent further edits",
          preview: "In-browser preview for PDFs, images, Office docs",
        },
        filters: [
          "Document type (Drawings, Specifications, Reports, etc.)",
          "Category (custom per project)",
          "Status (Draft, For Review, Approved, Superseded)",
          "Date range",
          "Uploaded by",
          "Search by name/number",
        ],
        permissions: {
          architect: "Upload, edit, approve, share, lock",
          builder: "Upload, edit, share",
          contractor: "Upload (limited), view shared docs",
          homeowner: "View shared docs only",
        },
      },
      {
        path: "/tenders",
        name: "Tenders & Procurement",
        description: "Complete tender lifecycle from creation to contract award",
        builderExperience: {
          create: [
            "Create tender with title, description, dates",
            "Upload tender package (drawings, specs, BOQ)",
            "Define line items manually or import from Excel",
            "Set tender visibility (public/invite-only)",
            "Generate shareable tender link",
            "Invite specific contractors via email",
          ],
          review: [
            "View all submitted bids",
            "Side-by-side bid comparison table",
            "Filter and sort by price, experience, certifications",
            "View contractor profiles and references",
            "Line-item comparison across bids",
            "Evaluation scoring matrix",
            "Award contract to winning bidder",
            "Notify all bidders of outcome",
          ],
        },
        contractorExperience: {
          discover: [
            "Receive tender invitation email",
            "Access via tender link or browse public tenders",
            "View tender details and documents",
            "Download tender package",
          ],
          bid: [
            "Submit bid with company details",
            "Fill line items with rates and amounts",
            "Import line items from Excel template",
            "Upload supporting documents (insurance, certifications)",
            "Add methodology statement",
            "Submit digital signature",
            "Track bid status (submitted/under review/awarded/rejected)",
          ],
        },
        analytics: [
          "Total tender value",
          "Number of bids received",
          "Average bid price",
          "Bid price range visualization",
          "Timeline of tender activity",
        ],
      },
      {
        path: "/rfis",
        name: "RFIs / Mail",
        description: "Request for Information system - structured communication for clarifications",
        features: {
          create: [
            "Create RFI with subject, description, priority",
            "Attach reference documents or drawings",
            "Assign to specific team member/role",
            "Set due date",
            "Categorize (design, specification, site, coordination)",
            "Link to related RFIs",
          ],
          respond: [
            "View RFI details and attachments",
            "Add response with text and attachments",
            "Change RFI status (open/in-progress/responded/closed)",
            "Mark as urgent or escalate",
            "Add internal notes (not visible to requester)",
          ],
          tracking: [
            "Inbox view: All RFIs (sent/received)",
            "Filter by status, priority, category, assignee",
            "Sort by date, due date, RFI number",
            "Search RFI content",
            "Export RFI register to Excel",
            "Email notifications for new RFIs and responses",
          ],
        },
        workflow: [
          "Contractor submits RFI to builder/architect",
          "Email notification sent to assignee",
          "Architect reviews and responds",
          "Response notification sent to requester",
          "RFI marked as closed when resolved",
          "Full audit trail of all communications",
        ],
        permissions: {
          create: ["architect", "builder", "contractor"],
          respond: ["architect", "builder"],
          view: "Based on project membership and RFI visibility",
        },
      },
      {
        path: "/messages",
        name: "Messages",
        description: "Real-time chat and threaded conversations",
        features: [
          "Create conversation threads by topic",
          "Real-time messaging with typing indicators",
          "File attachments in messages",
          "Quote/reply to specific messages",
          "Mention users with @ notation",
          "Mark threads as pinned or archived",
          "Search message history",
          "Message read receipts",
          "Emoji reactions",
        ],
        organization: [
          "Threads organized by project",
          "Filter: Active/Archived/Pinned",
          "Search across all messages",
          "Unread message indicators",
        ],
      },
      {
        path: "/calendar",
        name: "Calendar",
        description: "Project scheduling and event management",
        features: [
          "Month/Week/Day/Agenda views",
          "Create events with start/end times",
          "Recurring events (daily/weekly/monthly)",
          "Event categories (meeting, deadline, milestone, inspection)",
          "Invite attendees (internal users + external emails)",
          "Add location and meeting links",
          "Set reminders (5min, 15min, 1hr, 1day before)",
          "Color-coded by category",
          "Drag-and-drop to reschedule",
          "Event templates for common meetings",
          "Export to iCal",
        ],
        integrations: "Syncs with project milestones and tender deadlines",
      },
      {
        path: "/financials",
        name: "Financials",
        description: "Comprehensive project financial management",
        tabs: [
          {
            name: "Budget Overview",
            features: [
              "Contract value vs actual spend",
              "Budget allocation by category",
              "Variance analysis",
              "Project margin tracking",
            ],
          },
          {
            name: "Line Item Budgets",
            features: [
              "Detailed cost breakdown by trade/category",
              "Import from Excel",
              "Track percentage complete per item",
              "Balance to claim calculation",
            ],
          },
          {
            name: "Progress Claims",
            features: [
              "Create monthly progress claims",
              "Line item percentage complete",
              "Include variations and change orders",
              "GST calculation",
              "Claim approval workflow",
              "Export claim to PDF",
            ],
          },
          {
            name: "Change Orders",
            features: [
              "Log variations and extras",
              "Track approval status",
              "Financial and schedule impact",
              "Link to supporting documents",
            ],
          },
          {
            name: "Invoices",
            features: [
              "Record vendor invoices",
              "Approval workflow",
              "Payment tracking",
              "Attach invoice PDFs",
            ],
          },
          {
            name: "Cashflow Forecast",
            features: [
              "Projected income and expenses",
              "Visual cashflow chart",
              "Monthly breakdown",
              "Scenario planning",
            ],
          },
        ],
        permissions: {
          builder: "Full access - create, edit, submit claims",
          architect: "Read-only access to overview",
          homeowner: "View claims and approve",
          contractor: "No access (unless specifically granted)",
        },
      },
      {
        path: "/todo-list",
        name: "To-Do List",
        description: "Personal task management integrated with projects",
        features: [
          "Create tasks with title, description, due date",
          "Link task to specific project",
          "Set priority (low/medium/high)",
          "Mark as complete",
          "Filter by project, status, priority",
          "Sort by due date or priority",
        ],
      },
      {
        path: "/admin/*",
        name: "Admin Panel",
        description: "System administration and monitoring (system_admin role only)",
        sections: [
          {
            name: "Dashboard",
            widgets: [
              "System health metrics",
              "Active users count",
              "Error rate (24h)",
              "Critical alerts",
              "Recent activity log",
            ],
          },
          {
            name: "User Management",
            features: [
              "View all users with profiles",
              "Approve/reject pending users",
              "Edit user roles",
              "Deactivate users",
              "Search and filter users",
              "View user activity history",
            ],
          },
          {
            name: "Activity Logs",
            features: [
              "Real-time activity feed",
              "Filter by action type, user, date range",
              "Export logs to CSV",
              "Detailed event metadata",
            ],
          },
          {
            name: "Audit Logs",
            features: [
              "Admin action audit trail",
              "IP address and user agent tracking",
              "Before/after values for changes",
              "Compliance reporting",
            ],
          },
          {
            name: "System Alerts",
            features: [
              "Configure alert rules",
              "Alert notifications (email, in-app)",
              "Severity levels (info, warning, critical)",
              "Alert acknowledgment workflow",
            ],
          },
          {
            name: "Analytics",
            features: [
              "User engagement metrics",
              "Feature usage statistics",
              "Performance monitoring",
              "Database health",
            ],
          },
        ],
      },
    ],
  },

  security: {
    title: "Security Implementation",
    authentication: [
      "Supabase Auth with email/password",
      "Email verification required on signup",
      "Secure password reset flow via email",
      "Session management with JWT tokens",
      "Multi-device session support",
    ],
    authorization: [
      "Row-Level Security (RLS) policies on all tables",
      "Role-based access control (RBAC)",
      "Project-based data isolation",
      "Document permission system (view/edit/admin)",
      "API endpoint protection via Supabase Auth",
    ],
    dataProtection: [
      "All data encrypted at rest (Supabase default)",
      "HTTPS/TLS for all communication",
      "Secure file upload to Supabase Storage",
      "Storage bucket RLS policies",
      "Automatic backup and point-in-time recovery",
    ],
    monitoring: [
      "Audit logging of all admin actions",
      "Activity tracking for user actions",
      "Login attempt monitoring",
      "Error tracking and alerting",
      "Real-time security alerts",
    ],
  },

  setup: {
    title: "Required Setup & Configuration",
    secrets: [
      {
        name: "RESEND_API_KEY",
        purpose: "Email delivery via Resend",
        required: true,
        setup: "1. Sign up at resend.com\n2. Create API key in dashboard\n3. Add to Supabase Edge Function secrets",
      },
      {
        name: "SITE_URL",
        purpose: "Base URL for email links",
        required: true,
        value: "Production: https://storea.com.au\nStaging: https://lovable-subdomain.lovable.app",
        setup: "Set in Supabase Edge Function secrets",
      },
      {
        name: "SUPABASE_URL",
        purpose: "Supabase project URL",
        required: true,
        setup: "Auto-configured when using Lovable Cloud",
      },
      {
        name: "SUPABASE_ANON_KEY",
        purpose: "Supabase anonymous access key",
        required: true,
        setup: "Auto-configured when using Lovable Cloud",
      },
    ],
    supabaseConfig: [
      "Enable email provider in Supabase Auth settings",
      "Configure email templates (optional, for branding)",
      "Set up storage buckets: 'documents', 'avatars', 'tender-documents'",
      "Enable Realtime for real-time features",
      "Deploy Edge Functions from supabase/functions/",
      "Run database migrations from supabase/migrations/",
    ],
    storeaBot: [
      "1. Create Gmail account: storeabot@gmail.com",
      "2. Sign up in STOREA app with that email",
      "3. Set display name to 'STOREA Bot'",
      "4. In Supabase SQL Editor, run: SELECT add_storea_bot_to_all_projects();",
      "5. Bot will auto-join all future projects via trigger",
    ],
    deployment: [
      "Frontend deployed on Vercel",
      "Custom domains: www.storea.com.au, storea.com.au",
      "DNS: A record @ → 216.198.79.1, CNAME www → Vercel",
      "vercel.json configures Vite build and SPA routing",
      "Backend (Supabase) hosted by Lovable Cloud",
    ],
  },
};
